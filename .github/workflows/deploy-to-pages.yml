name: Deploy Projects to GitHub Pages

on:
  push:
    branches: [ main ]
    paths:
      - 'CoursesCertificationProjects/**'
  workflow_dispatch:

jobs:
  deploy:
    runs-on: ubuntu-latest
    permissions:
      contents: read
      pages: write
      id-token: write
    
    steps:
      - uses: actions/checkout@v4
      
      - name: Create deployment structure
        run: |
          mkdir -p build
          
          cat > build/index.html << 'EOF'
          <!DOCTYPE html>
          <html lang="en">
          <head>
              <meta charset="UTF-8">
              <meta name="viewport" content="width=device-width, initial-scale=1.0">
              <title>freeCodeCamp Projects Portfolio</title>
              <style>
                  body { 
                      font-family: Arial, sans-serif; 
                      max-width: 1200px; 
                      margin: 0 auto; 
                      padding: 20px;
                      background-color: #f5f5f5;
                  }
                  .header {
                      text-align: center;
                      background: #0a0a23;
                      color: white;
                      padding: 40px 20px;
                      border-radius: 10px;
                      margin-bottom: 30px;
                  }
                  .header h1 { font-size: 2.5rem; margin: 0; }
                  .header p { font-size: 1.2rem; margin: 10px 0 0 0; opacity: 0.9; }
                  .projects { 
                      display: grid; 
                      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); 
                      gap: 20px; 
                  }
                  .project { 
                      background: white;
                      padding: 25px;
                      border-radius: 10px;
                      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
                      transition: transform 0.3s ease;
                  }
                  .project:hover { transform: translateY(-5px); }
                  .project h3 { color: #0a0a23; margin: 0 0 10px 0; }
                  .project p { color: #666; margin: 0 0 15px 0; }
                  .project a { 
                      background: #0a0a23;
                      color: white;
                      padding: 10px 20px;
                      text-decoration: none;
                      border-radius: 5px;
                      display: inline-block;
                  }
                  .project a:hover { background: #1b1b32; }
              </style>
          </head>
          <body>
              <div class="header">
                  <h1>freeCodeCamp Projects</h1>
                  <p>My Web Development Portfolio</p>
              </div>
              <div class="projects">
                  <!-- PROJECTS_PLACEHOLDER -->
              </div>
          </body>
          </html>
          EOF
          
          PROJECT_COUNT=0
          echo "" > projects.txt
          
          for project_dir in CoursesCertificationProjects/Responsive-Web-Design/*/; do
            if [ -d "$project_dir" ] && [ -f "${project_dir}index.html" ]; then
              PROJECT_NAME=$(basename "$project_dir")
              echo "Processing project: $PROJECT_NAME"
              
              mkdir -p "build/$PROJECT_NAME"
              cp -r "$project_dir"* "build/$PROJECT_NAME/" 2>/dev/null || true
              
              echo "<div class=\"project\">" >> projects.txt
              echo "<h3>$PROJECT_NAME</h3>" >> projects.txt
              echo "<p>A responsive web design project</p>" >> projects.txt
              echo "<a href=\"./$PROJECT_NAME/\">View Project</a>" >> projects.txt
              echo "</div>" >> projects.txt
              
              PROJECT_COUNT=$((PROJECT_COUNT + 1))
            fi
          done
          
          echo "Found $PROJECT_COUNT projects"
          
          if [ $PROJECT_COUNT -eq 0 ]; then
            echo "<div class=\"project\"><h3>No projects found</h3><p>Add projects to get started</p></div>" > projects.txt
          fi
          
          python3 << 'PYTHON_EOF'
          with open('build/index.html', 'r') as f:
              content = f.read()
          
          with open('projects.txt', 'r') as f:
              projects = f.read()
          
          content = content.replace('<!-- PROJECTS_PLACEHOLDER -->', projects)
          
          with open('build/index.html', 'w') as f:
              f.write(content)
          PYTHON_EOF
          
          rm projects.txt
          echo "Build directory structure:"
          find build -type f | head -20
      
      - name: Setup Pages
        uses: actions/configure-pages@v4
      
      - name: Upload artifact
        uses: actions/upload-pages-artifact@v3
        with:
          path: './build'
      
      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4